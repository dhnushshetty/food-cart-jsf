<!DOCTYPE html>
<html>
<head>
    <title>Cart - Food Cart Platform</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: Arial, sans-serif; background: #f5f5f5; }
        .navbar { background: #2c3e50; color: white; padding: 1rem 2rem; display: flex; justify-content: space-between; align-items: center; }
        .navbar h1 { font-size: 1.5rem; }
        .navbar a { color: white; text-decoration: none; margin-left: 1rem; padding: 0.5rem 1rem; border-radius: 4px; }
        .navbar a:hover { background: #34495e; }
        .container { max-width: 800px; margin: 2rem auto; padding: 0 2rem; }
        .cart-item { background: white; padding: 1rem; margin-bottom: 1rem; border-radius: 4px; display: flex; justify-content: space-between; align-items: center; }
        .cart-item-info h3 { margin-bottom: 0.5rem; }
        .cart-item-info p { color: #7f8c8d; }
        .btn { padding: 0.8rem 2rem; background: #667eea; color: white; border: none; border-radius: 4px; cursor: pointer; }
        .btn:hover { background: #5568d3; }
        .btn-danger { background: #e74c3c; }
        .btn-danger:hover { background: #c0392b; }
        .total { font-size: 1.5rem; font-weight: bold; margin: 2rem 0; background: white; padding: 1.5rem; border-radius: 4px; }
        .empty-cart { text-align: center; padding: 3rem; background: white; border-radius: 4px; }
    </style>
</head>
<body>
    <nav class="navbar">
        <h1>ðŸ›’ My Cart</h1>
        <div>
            <a href="/shops">Browse Shops</a>
            <a href="/orders">Orders</a>
            <a href="#" onclick="logout()">Logout</a>
        </div>
    </nav>
    <div class="container">
        <div id="cartItems"></div>
        <div class="total" id="total" style="display: none;"></div>
        <button class="btn" id="placeOrderBtn" onclick="placeOrder()" style="display: none;">Place Order</button>
    </div>
    <script>
        const token = localStorage.getItem('token');
        if (!token) window.location.href = '/login';
        
        async function loadCart() {
            try {
                const response = await fetch('/api/cart', {
                    headers: { 'Authorization': 'Bearer ' + token }
                });
                const cart = await response.json();
                const container = document.getElementById('cartItems');
                const totalDiv = document.getElementById('total');
                const placeOrderBtn = document.getElementById('placeOrderBtn');
                
                if (!cart.items || cart.items.length === 0) {
                    container.innerHTML = '<div class="empty-cart"><h2>Your cart is empty</h2><p>Browse shops and add items to your cart</p><br><a href="/shops" class="btn">Browse Shops</a></div>';
                    totalDiv.style.display = 'none';
                    placeOrderBtn.style.display = 'none';
                    return;
                }
                
                container.innerHTML = cart.items.map(function(item) {
                    return '<div class="cart-item">' +
                        '<div class="cart-item-info">' +
                        '<h3>' + item.menuItemName + '</h3>' +
                        '<p>â‚¹' + item.price + ' Ã— ' + item.quantity + ' = â‚¹' + (item.price * item.quantity).toFixed(2) + '</p>' +
                        '</div>' +
                        '<button class="btn btn-danger" onclick="removeItem(' + item.id + ')">Remove</button>' +
                        '</div>';
                }).join('');
                
                totalDiv.textContent = 'Total: â‚¹' + cart.totalAmount;
                totalDiv.style.display = 'block';
                placeOrderBtn.style.display = 'inline-block';
            } catch (error) {
                console.error('Error loading cart:', error);
            }
        }
        
        async function removeItem(id) {
            try {
                const response = await fetch('/api/cart/remove/' + id, {
                    method: 'DELETE',
                    headers: { 'Authorization': 'Bearer ' + token }
                });
                
                if (response.ok) {
                    loadCart();
                } else {
                    alert('Failed to remove item from cart');
                }
            } catch (error) {
                console.error('Error removing item:', error);
                alert('Error removing item from cart');
            }
        }
        
        async function placeOrder() {
            try {
                const response = await fetch('/api/orders/place', {
                    method: 'POST',
                    headers: { 'Authorization': 'Bearer ' + token }
                });
                
                if (response.ok) {
                    alert('Order placed successfully!');
                    window.location.href = '/orders';
                } else {
                    const error = await response.text();
                    alert('Failed to place order: ' + error);
                }
            } catch (error) {
                console.error('Error placing order:', error);
                alert('Error placing order');
            }
        }
        
        function logout() {
            localStorage.clear();
            window.location.href = '/';
        }
        
        loadCart();
    </script>
</body>
</html>

<!DOCTYPE html>
<html>
<head>
    <title>Cart - Food Cart Platform</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: Arial, sans-serif; background: #f5f5f5; }
        .navbar { background: #2c3e50; color: white; padding: 1rem 2rem; display: flex; justify-content: space-between; }
        .navbar h1 { font-size: 1.5rem; }
        .navbar a { color: white; text-decoration: none; margin-left: 1rem; padding: 0.5rem 1rem; }
        .container { max-width: 800px; margin: 2rem auto; padding: 0 2rem; }
        .cart-item { background: white; padding: 1rem; margin-bottom: 1rem; border-radius: 4px; display: flex; justify-content: space-between; }
        .btn { padding: 0.8rem 2rem; background: #667eea; color: white; border: none; border-radius: 4px; cursor: pointer; }
        .btn-danger { background: #e74c3c; }
        .total { font-size: 1.5rem; font-weight: bold; margin: 2rem 0; }
    </style>
</head>
<body>
    <nav class="navbar">
        <h1>üçï My Cart</h1>
        <div>
            <a href="/shops">Browse Shops</a>
            <a href="/orders">Orders</a>
            <a href="#" onclick="logout()">Logout</a>
        </div>
    </nav>
    <div class="container">
        <div id="cartItems"></div>
        <div class="total" id="total"></div>
        <button class="btn" onclick="placeOrder()">Place Order</button>
    </div>
    <script>
        const token = localStorage.getItem('token');
        if (!token) window.location.href = '/login';
        
        async function loadCart() {
            const response = await fetch('/api/cart', {
                headers: { 'Authorization': `Bearer ${token}` }
            });
            const cart = await response.json();
            const container = document.getElementById('cartItems');
            
            if (!cart.items || cart.items.length === 0) {
                container.innerHTML = '<p>Your cart is empty</p>';
                return;
            }
            
            container.innerHTML = cart.items.map(item => `
                <div class="cart-item">
                    <div>
                        <h3>${item.menuItemName}</h3>
                        <p>$${item.price} x ${item.quantity}</p>
                    </div>
                    <button class="btn btn-danger" onclick="removeItem(${item.id})">Remove</button>
                </div>
            `).join('');
            
            document.getElementById('total').textContent = `Total: $${cart.totalAmount}`;
        }
        
        async function removeItem(id) {
            await fetch(`/api/cart/remove/${id}`, {
                method: 'DELETE',
                headers: { 'Authorization': `Bearer ${token}` }
            });
            loadCart();
        }
        
        async function placeOrder() {
            const response = await fetch('/api/orders/place', {
                method: 'POST',
                headers: { 'Authorization': `Bearer ${token}` }
            });
            if (response.ok) {
                alert('Order placed successfully!');
                window.location.href = '/orders';
            }
        }
        
        function logout() {
            localStorage.clear();
            window.location.href = '/';
        }
        
        loadCart();
    </script>
</body>
</html>
